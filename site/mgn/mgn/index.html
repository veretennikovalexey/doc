<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>mgn - Мои дела</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "mgn";
        var mkdocs_page_input_path = "mgn\\mgn.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Мои дела
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../%D0%9A%D0%BE%D0%BD%D1%82%D1%83%D1%80/%D0%9A%D0%BE%D0%BD%D1%82%D1%83%D1%80/">192 Контур</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../%D0%9A%D0%BE%D1%80%D1%83%D1%81/%D0%9A%D0%BE%D1%80%D1%83%D1%81/">105 Корус</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Exite/Exite/">152 Exite</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../arx/arx/">arx</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../dtv/dtv/">dtv</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../ehc/ehc/">ehc</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../ghc/ghc/">ghc</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../ig2/ig2/">ig2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../klm/klm/">klm</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../krl/krl/">krl</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">mgn</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#r641-2">R641 (2) Контур</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_edi_ld_orders">_EDI_LD_ORDERS</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../mor/mor/">mor</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../orl/orl/">orl</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../sn1/sn1/">sn1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../srg/srg/">srg</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../trb/trb/">trb</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../vor/vor/">vor</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../whc/whc/">whc</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../zrs/zrs/">zrs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">sftserv.ru/chronology/DISP/826.htm</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../index2/">Информация об организации по GLN</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../folder/folder/">Четвёртое ТО</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Мои дела</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">mgn</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mgnmd">mgn.md</h1>
<p>Диспетчерская (все заказы) - Документы - Заказы торговли / ездки - Заказы за смену</p>
<p>Принято из EDI (24.08.2025 11:26:25) ДатИсп:25.08.2025</p>
<p>Программа _EDI_LD_ORDERS</p>
<h2 id="r641-2">R641 (2) Контур</h2>
<p>Документы ON_NSCHFDOPPR располагаются в папке</p>
<p>\\WIN2008BUH\Fabius\Edi_qwerty\</p>
<h2 id="_edi_ld_orders">_EDI_LD_ORDERS</h2>
<ol>
<li>
<p><strong>Запуск процесса получения файлов с FTP</strong>:<br />
   Программа запускает внешний Java-артефакт (<code>FtpLDForFab.jar</code>) для загрузки файлов заказов с FTP-сервера в локальный каталог.</p>
</li>
<li>
<p><strong>Проверка блокировки процесса</strong>:<br />
   Проверяет наличие файла-блокировки (с расширением <code>.chk</code>) в целевом каталоге. Если обнаружена активная блокировка (созданная менее 0.15 часов назад), выводится сообщение о уже запущенном процессе и выполнение прерывается.</p>
</li>
<li>
<p><strong>Создание файла-блокировки</strong>:<br />
   Создается новый файл-блокировка для предотвращения параллельного запуска.</p>
</li>
<li>
<p><strong>Поиск XML-файлов в каталоге</strong>:<br />
   Рекурсивно сканирует целевой каталог и подкаталоги для поиска всех XML-файлов, соответствующих маске.</p>
</li>
<li>
<p><strong>Обработка каждого XML-файла</strong>:<br />
   Для каждого найденного XML-файла выполняется:</p>
</li>
<li><strong>Парсинг XML</strong>: Используется шаблон <code>LeraDataOrderToDpMHK.xtr</code> для преобразования XML-данных в структурированный формат.</li>
<li><strong>Валидация данных</strong>: Проверяется наличие обязательных полей (например, номера заказа).</li>
<li><strong>Сопоставление кодов</strong>:  <ul>
<li>Поиск кода магазина (<code>R20</code>) по GLN-коду из поля <code>DELIVERYPLACE</code>.  </li>
<li>Определение кода организации-заказчика (<code>R01</code>) по коду магазина.  </li>
<li>Корректировка даты доставки с учетом времени в пути (если указано в справочнике <code>R456</code>).</li>
</ul>
</li>
<li><strong>Проверка дубликатов</strong>: Ищет существующие заказы с тем же номером и заказчиком в базе данных. Если найден, пропускает обработку.</li>
<li><strong>Логирование операции</strong>: Записывает информацию о заказе в таблицу <code>EDI_log</code> (ID сообщения, даты, номера, GLN, содержимое файла и т.д.).</li>
<li><strong>Обработка позиций заказа</strong>:  <ul>
<li>Для каждой позиции ищется код товара (<code>R11</code>) по штрих-коду или внутреннему коду покупателя.  </li>
<li>Проверяется разрешена ли продукция к отгрузке для данного заказчика и магазина.  </li>
<li>Формируется массив позиций заказа с количеством.</li>
</ul>
</li>
<li>
<p><strong>Обработка ошибок</strong>: Если обнаружены неизвестные товары или запрещенные к отгрузке, выводится запрос на продолжение обработки.</p>
</li>
<li>
<p><strong>Фильтрация и выбор заказов для импорта</strong>:<br />
   Пользователю предоставляется меню для выбора заказов по датам и магазинам. Только выбранные заказы будут импортированы.</p>
</li>
<li>
<p><strong>Импорт заказов в базу данных</strong>:  </p>
</li>
<li><strong>Разделение на партии</strong>: Большие списки заказов разбиваются на партии по 200 шт. для избежания проблем с производительностью.</li>
<li><strong>Удаление дубликатов</strong>: Перед добавлением удаляются существующие записи заказов с теми же номерами и магазинами.</li>
<li><strong>Добавление шапок заказов</strong>: Данные заносятся в таблицу <code>ZAK</code> (уровень 1).</li>
<li><strong>Обновление лога</strong>: В таблице <code>EDI_log</code> обновляются номера документов (<code>RGNUM</code>) и другие детали.</li>
<li>
<p><strong>Добавление позиций заказа</strong>: Данные заносятся в таблицу <code>ZAK</code> (уровень 2).</p>
</li>
<li>
<p><strong>Завершение операции</strong>:  </p>
</li>
<li>Удаление обработанных XML-файлов и файлов-блокировок из каталога.</li>
<li>Закрытие открытых справочников и таблиц.</li>
<li>
<p>Вывод сообщения о завершении приема заказов.</p>
</li>
<li>
<p><strong>Вспомогательная функция <code>AllFiles</code></strong>:<br />
   Рекурсивно ищет все файлы по маске в указанном каталоге и его подкаталогах.</p>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../krl/krl/" class="btn btn-neutral float-left" title="krl"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../mor/mor/" class="btn btn-neutral float-right" title="mor">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../krl/krl/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../mor/mor/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
